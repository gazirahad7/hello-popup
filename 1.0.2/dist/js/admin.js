(()=>{"use strict";document?.addEventListener("DOMContentLoaded",(()=>{if("undefined"!=typeof wp&&wp.codeEditor){const e=document.getElementById("hello_popup_custom_css");if(!e)return;const t=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{};t.codemirror=Object.assign({},t.codemirror,{mode:"css",lineNumbers:!0,indentUnit:2,tabSize:2});const o=wp.codeEditor.initialize(e,t);window.helloPopupCssEditor=o.codemirror}const e=document.getElementById("hello-popup-settings-form"),t=document.getElementById("hello-popup-settings-message");if(!e)return;const o=document.getElementById("hello_popup_custom_css");function n(e,t="success"){const o=document.getElementById("hello-toast-container");if(!o)return;const n=document.createElement("div");n.className="hello-toast","error"===t?n.style.backgroundColor="#dc3545":"success"===t?n.style.backgroundColor="#28a745":"info"===t&&(n.style.backgroundColor="#007bff"),n.textContent=e,o.appendChild(n),setTimeout((()=>{n.remove()}),3e3)}e?.addEventListener("submit",(async s=>{if(s.preventDefault(),t.textContent="Saving...",t.style.color="gray",window.helloPopupCssEditor&&"function"==typeof window.helloPopupCssEditor.save&&window.helloPopupCssEditor.save(),o&&o.value.length>1e4)return n(`Custom CSS must be less than 10000 characters. Currently: ${o.value.length}`,"error"),o.focus(),!1;const c=new FormData(e);try{const e=await fetch(ajaxurl,{method:"POST",body:c,credentials:"same-origin"}),o=await e.json();o.success?(t.textContent="Settings saved successfully!",t.style.color="green",n("Settings saved successfully!","success")):(t.textContent=o?.data?.message||"Failed to save settings.",t.style.color="red",n(o?.data?.message||"Failed to save settings.","error"))}catch(e){console.error("AJAX error:",e),t.textContent="An unexpected error occurred.",t.style.color="red",n("An unexpected error occurred.","error")}setTimeout((()=>{t.textContent=""}),3e3)}))})),document?.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("popup_image_button"),t=document.getElementById("popup_image_remove"),o=document.getElementById("popup_image_preview"),n=document.getElementById("hello_popup_image");let s;e?.addEventListener("click",(()=>{s||(s=wp.media({title:"Select or Upload Popup Image",button:{text:"Use this image"},multiple:!1}),s.on("select",(()=>{const c=s.state().get("selection").first().toJSON();o.src=c.url,o.style.display="block",t.style.display="block",n.value=c.url,e.textContent="Change Image"}))),s.open()})),t?.addEventListener("click",(()=>{o.src="",o.style.display="none",t.style.display="none",n.value="",e.textContent="Select Image"}));const c=document.getElementById("copy_trigger_class_btn"),l=document.getElementById("popup_trigger_class");c&&l&&c.addEventListener("click",(function(e){l.select(),l.setSelectionRange(0,99999),document.execCommand("copy");const t=c.textContent;c.textContent="Copied!",setTimeout((()=>{c.textContent=t}),1500)}));const d=document.getElementById("hello_popup_auto_show");d&&d.addEventListener("change",(()=>{d.checked||localStorage.removeItem("helloPopupClosedAt")}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document?.getElementById("save-settings");if(!e)return;let t=window?.scrollY;window?.addEventListener("scroll",(()=>{const o=window.scrollY;o<t&&o>300?e.classList.add("sticky"):(o>t||o<200)&&e.classList.remove("sticky"),t=o}))}))})();